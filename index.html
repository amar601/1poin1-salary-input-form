
<script>
const SHEET_URL = 'https://script.google.com/macros/s/AKfycbyUTka0B6u7e8tKgd6L8F071qFmikxdHdZn-o98Z-q1_FxJNvzAtYN-5GXaVq8Fz_s0cg/exec';

function toggleAdminLogin() {
  const loginDiv = document.getElementById("adminLoginDiv");
  loginDiv.style.display = loginDiv.style.display === "none" ? "block" : "none";
}

function verifyAdmin() {
  const input = document.getElementById("adminPassword").value;
  const ADMIN_PASSWORD = "admin123";
  if (input === ADMIN_PASSWORD) {
    document.getElementById("adminMode").value = "true";
    document.getElementById("adminStatus").innerText = "Admin Mode Enabled";
    document.getElementById("adminLoginDiv").style.display = "none";
  } else {
    alert("Incorrect password");
  }
  renderTable();
}

async function addEntry() {
  const loc = document.getElementById('location').value;
  const role = document.getElementById('role').value;
  const lang = document.getElementById('language').value;
  const salary = document.getElementById('salary').value;
  const user = document.getElementById('user').value.trim();

  if (!user) return alert("Please enter your name.");
  if (!salary || isNaN(salary)) return alert("Enter a valid salary.");

  const formData = new FormData();
  formData.append('location', loc);
  formData.append('role', role);
  formData.append('language', lang);
  formData.append('salary', salary);
  formData.append('user', user);

  try {
    const response = await fetch(SHEET_URL, {
      method: 'POST',
      body: formData
    });
    const text = await response.text();
    alert("Entry added: " + text);
    renderTable();
  } catch (err) {
    alert("Failed to add entry: " + err.message);
    console.error(err);
  }

  document.getElementById('salary').value = '';
}

async function getFromGoogleSheet() {
  const response = await fetch(SHEET_URL);
  const data = await response.json();
  return data.map(row => ({
    location: row[0],
    role: row[1],
    language: row[2],
    salary: row[3],
    user: row[4]
  }));
}

async function renderTable() {
  const tableBody = document.getElementById('salaryTable').getElementsByTagName('tbody')[0];
  tableBody.innerHTML = '';
  const admin = document.getElementById("adminMode").value === "true";
  const locationFilter = document.getElementById("locationFilter").value;

  const entries = await getFromGoogleSheet();

  entries.forEach((entry, index) => {
    if (locationFilter !== "ALL" && entry.location !== locationFilter) return;

    const row = tableBody.insertRow();
    row.insertCell(0).innerText = entry.location;
    row.insertCell(1).innerText = entry.role;
    row.insertCell(2).innerText = entry.language;
    row.insertCell(3).innerText = entry.salary;
    row.insertCell(4).innerText = entry.user;
  });
}

window.onload = () => renderTable();
</script>
